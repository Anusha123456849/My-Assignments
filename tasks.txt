1.RELATIONSHIP TASKS

 CREATE TABLE customers (
    customer_id INT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL ,
    city VARCHAR(50) NOT NULL
);

CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT NOT NULL 
        REFERENCES customers(customer_id),
    amount DECIMAL(10,2) NOT NULL,
    order_date DATE NOT NULL
);

INSERT INTO customers (customer_id, name, email, city) VALUES
(1, 'Anu',  'anu@gmail.com',  'Hyderabad'),
(2, 'Ravi', 'ravi@gmail.com', 'Delhi'),
(3, 'Amit', 'amit@gmail.com', 'Mumbai');

INSERT INTO orders (order_id, customer_id, amount, order_date) VALUES
(101, 1, 2500.00, '2025-01-10'),
(102, 1, 1500.00, '2025-01-12'),
(103, 2, 3000.00, '2025-01-15');

INSERT INTO orders (order_id, customer_id, amount, order_date)
VALUES (104, 99, 2000.00, '2025-01-20');



CREATE TABLE courses (
    course_id INT PRIMARY KEY,
    course_name VARCHAR(50) NOT NULL,
);



CREATE TABLE student_courses (
    student_id INT NOT NULL REFERENCES students(student_id),
    course_id INT NOT NULL REFERENCES courses(course_id),
    PRIMARY KEY (student_id, course_id)
);



2.INNER JOINS

select*from customers inner join orders on customers.customer_id=orders.customer_id;


select customers.name,customers.city from customers inner join orders on customers.customer_id=orders.customer_id;


CREATE TABLE employees (
    emp_id INT PRIMARY KEY,
    emp_name VARCHAR(50) NOT NULL,
    dept_id INT
);
CREATE TABLE departments (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(50) NOT NULL
);
INSERT INTO departments VALUE(10, 'HR'),(20, 'IT'),(30, 'Finance');

INSERT INTO employees VALUES(1, 'Anu', 10),(2, 'Ravi', 20),(3, 'Amit', 30),(4, 'Neha', 20);

SELECT employees.emp_name ,departments.dept_name FROM employees  inner JOIN departments  ON employees.dept_id = departments.dept_id;

CREATE TABLE products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(50) NOT NULL
);


CREATE TABLE order_items (
    order_id INT REFERENCES orders(order_id),
    product_id INT REFERENCES products(product_id),
    quantity INT NOT NULL,
);

INSERT INTO products VALUES(10, 'Laptop'),(20, 'Mouse'),(30, 'Keyboard');
INSERT INTO order_items VALUES (101, 10), (102, 20),(103, 30);

SELECT o.order_id,p.product_name FROM orders o inner JOIN order_items oi ON o.order_id = oi.order_id inner JOIN products p ON oi.product_id = p.product_id;

SELECT o.order_id,p.product_name,o.amount FROM orders o inner JOIN order_items oi ON o.order_id = oi.order_id inner JOIN products p ON oi.product_id = p.product_id where o.amount>1500;

SELECT o.order_id,p.product_name,o.amount FROM orders o inner JOIN order_items oi ON o.order_id = oi.order_id inner JOIN products p ON oi.product_id = p.product_id where  p.product_name like 'L%';





3. LEFT JOIN

select c.customer_id,o.order_id from customers c left join orders o on c.customer_id=o.customer_id; 

select c.customer_id ,o.customer_id from customers c left join orders o on c.customer_id=o.customer_id where o.order_id is null; 

select d.dept_id,e.emp_id from employees e  left join departments d on d.dept_id=e.dept_id;

select d.dept_id,e.emp_id from employees e  left join departments d on d.dept_id=e.dept_id where e.emp_id is null;

select p.product_id from products p left join order_items oi on p.product_id=oi.product_id where oi.order_id is null;

select oi.product_id from products p left join order_items oi on p.product_id=oi.product_id where p.product_id>20;

select p.product_name from products p left join order_items oi on p.product_id=oi.product_id where p.product_name like 'p%';


4.RIGHT JOIN

select c.customer_id,o.order_id from orders o right join customers c  on c.customer_id=o.customer_id;

select o.order_id from orders o right join customers c  on c.customer_id=o.customer_id where c.customer_id is null;

select d.dept_id from employees e right join departments d on d.dept_id=e.dept_id;
 
select oi.product_id from products p right join order_items oi on p.product_id=oi.product_id where p.product_id>20;

SELECT d.dept_id, COUNT(e.emp_id) FROM employees e RIGHT JOIN departments d ON e.dept_id = d.dept_id GROUP BY d.dept_id;


5.FULL OUTER JOIN

SELECT *FROM customers c FULL OUTER JOIN orders o  ON c.customer_id=o.customer_id;

select*from employees e full outer join departments d on e.dept_id=d.dept_id;

SELECT e.emp_id, e.emp_name, d.dept_name FROM employees e LEFT JOIN departments d ON e.dept_id = d.dept_id
UNION
SELECT e.emp_id, e.emp_name, d.dept_name FROM employees e RIGHT JOIN departments d ON e.dept_id = d.dept_id;

6.SELF JOIN

select e.emp_id,m.manager_name from employees e  join employees m on e.emp_id=m.emp_id;

select e.emp_id,m.manager_name from employees e  join employees m on e.manager_name=m.manager_name and e.emp_id <> m.emp_id;

select distinct e.manager_name from employees e join employees m on  e.emp_id=m.emp_id;

select  * from employees e join employees m on  e.mentor_id=m.mentor_id;

7.CROSS JOIN

SELECT c.name, p.product_name FROM customers c CROSS JOIN products p;

SELECT e.emp_name, p.role  FROM employees e CROSS JOIN employees p;

8.MULTI TABLE JOIN TASKS

SELECT c.name,o.order_id, o.order_date,oi.product_id FROM customers c JOIN orders o ON c.customer_id = o.customer_id JOIN order_items oi ON o.order_id = oi.order_id;

SELECT o.order_id,p.product_name,s.supplier_name FROM orders o JOIN order_items oi ON o.order_id = oi.order_id JOIN products p ON oi.product_id = p.product_id JOIN suppliers s ON p.suppliers_id = s.supplier_id;

SELECT e.emp_name,d.dept_name,l.city FROM employees e JOIN departments d ON e.dept_id = d.dept_id JOIN locations l ON d.location_id = l.location_id;
SELECT e.emp_name,d.dept_name,l.city FROM employees e JOIN departments d ON e.dept_id = d.dept_id JOIN locations l ON d.location_id = l.location_id;

SELECT c.customer_id,c.name, o.order_id,o.order_date,oi.product_id,p.product_name FROM customers c JOIN orders o ON c.customer_id = o.customer_id JOIN order_items oi ON o.order_id = oi.order_id JOIN products p ON oi.product_id = p.product_id;


9.SELF + GROUP BY

select c.customer_id,count(c.customer_id) from customers c left join orders o on c.customer_id=o.customer_id group by c.customer_id;

select c.customer_id,sum(o.amount) from customers c left join orders o on c.customer_id=o.customer_id group by c.customer_id; 

select d.dept_id,count(e.emp_id) from employees e right join departments d on d.dept_id=e.dept_id group by d.dept_id;

select p.product_name,COUNT(oi.order_id) FROM products p left JOIN order_items oi ON p.product_id = oi.product_id GROUP BY p.product_name;

select d.dept_id,sum(e.salary) from departments d left join employees e on d.dept_id=e.dept_id group by d.dept_id;

10.JOIN + HAVING

select c.customer_id,count(c.customer_id) from customers c left join orders o on c.customer_id=o.customer_id group by c.customer_id having count(c.customer_id)>3;

select d.dept_id,count(e.emp_id) from employees e right join departments d on d.dept_id=e.dept_id group by d.dept_id having count(e.emp_id)>5;

select p.product_name,COUNT(oi.order_id) FROM products p left JOIN order_items oi ON p.product_id = oi.product_id GROUP BY p.product_name having count(oi.order_id)>10

select d.dept_id,sum(e.salary) from departments d left join employees e on d.dept_id=e.dept_id group by d.dept_id having sum(e.salary)>20000;

11.JOIN + COUNT

select c.city,count(o.order_id) from customers c left join orders o on c.customer_id=o.customer_id group by c.city;

12. JOIN + where

select o.order_id,c.customer_id from customers c inner join orders o on c.customer_id=o.customer_id where o.order_date>'2025-01-10'; 

select e.emp_id from employees e inner join departments d on e.dept_id=d.dept_id where d.dept_name='HR';

select c.customer_id,c.city  from customers c  join orders d on c.customer_id=d.customer_id where c.city='Hyderabad';

select p.product_id,p.product_name from products p join order_items oi on p.product_id=oi.product_id where p.price>10000; 

13. JOIN + LIKE 

select distinct c.name from customers c  left join orders d on c.customer_id=d.customer_id where c.name like 'A%';

select e.emp_name from employees e inner join departments d on e.dept_id=d.dept_id where e.emp_name like 'A%';

select p.product_name from products p left join order_items oi on p.product_id=oi.product_id where p.product_name like 'p%';

14. JOIN + CONSTRAINT TASKS

15.JOIN + SUB QUIRIES

select customer_id from customers where customer_id in(select customer_id from orders);

select * from products where product_id not in(select product_id from order_items);

select * from employees where dept_id not in(select dept_id from departments);

select* from orders  where amount>(select avg(amount) from orders);

SELECT e.emp_id, e.emp_name, e.salary FROM employees e WHERE e.salary > (SELECT AVG(e2.salary)FROM employees e2 WHERE e2.dept_id = e.dept_id);

SELECT c.name, o.order_id FROM customers c JOIN orders o ON c.customer_id = o.customer_id AND o.amount > ( SELECT AVG(amount) FROM orders);

SELECT c.name, avg_orders.avg_amount FROM customers c JOIN (SELECT customer_id, AVG(amount) AS avg_amount FROM orders GROUP BY customer_id) avg_orders ON c.customer_id = avg_orders.customer_id;

SELECT * FROM customers c WHERE EXISTS (SELECT * FROM orders o WHERE o.customer_id = c.customer_id);

SELECT *FROM customers c WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.customer_id);

SELECT c.name, o.amount FROM customers c JOIN orders o ON c.customer_id = o.customer_id WHERE o.amount > (SELECT AVG(o2.amount)FROM orders o2 WHERE o2.customer_id = c.customer_id);


16.MULTI SELECT JOIN TASKS 

SELECT c.name AS customer_name,o.order_id AS order_no, o.amount AS order_amount FROM customers AS c INNER JOIN orders AS o ON c.customer_id = o.customer_id;

SELECT c.name,o.order_id,o.amount,(o.amount * 0.18) AS tax,(o.amount + o.amount * 0.18) AS total_amount FROM customers c JOIN orders o ON c.customer_id = o.customer_id;

SELECT c.name,o.order_id,o.amount,CASE WHEN o.amount >= 10000 THEN 'High Value' WHEN o.amount >= 5000 THEN 'Medium Value' ELSE 'Low Value'END AS order_category FROM customers c JOIN orders o ON c.customer_id = o.customer_id;

